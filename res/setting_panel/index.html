<!DOCTYPE html>
<!--suppress JSUnresolvedReference -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aicé Setting Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <style>
        body {
            overflow-y: scroll;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="display-1"><span class="fw-bold">Aicé</span> Setting Panel</h1>
    <p></p>
    <div class="row">
        <div class="col-sm-3">
            <p>
                <i class="bi-box" style="font-size: 1rem;"></i>
                <strong>Packs</strong>
            </p>
            <nav class="nav nav-pills flex-column" id="packs-list">
            </nav>
        </div>
        <div class="col-sm-9">
            <p>
                <i class="bi bi-journal-bookmark" style="font-size: 1rem;"></i>
                <strong>Abbreviations</strong>
            </p>
            <table class="table table-striped table-sm">
                <thead>
                <tr>
                    <th scope="col">Abbreviation</th>
                    <th scope="col">Meaning</th>
                </tr>
                </thead>
                <tbody id="abbreviations-list">
                </tbody>
            </table>
        </div>
    </div>
</div>

<!--suppress JSValidateTypes, JSCheckFunctionSignatures -->
<script>
  const packsList = document.getElementById('packs-list');
  const abbreviationsList = document.getElementById('abbreviations-list');

  window.addEventListener('pywebviewready', () => {
    loadPacks();
  });

  function loadPacks() {
    pywebview.api.get_packs().then(packs => {
      packs.forEach(pack => {
        const packItem = document.createElement('a');
        packItem.classList.add('nav-link');
        packItem.href = '#';
        packItem.innerText = pack;
        packItem.addEventListener('click', () => {
          setPack(pack);
        });
        packsList.appendChild(packItem);
      });
    });
  }

  function setPack(packName) {
    // update abbreviations list
    abbreviationsList.innerHTML = '';
    pywebview.api.get_pack_abbreviations(packName).then(abbreviations => {
      abbreviations.forEach((entry, _) => {
        const [key, value] = entry;

        const row = document.createElement('tr');

        const abbreviation = document.createElement('td');
        abbreviation.innerText = key;
        row.appendChild(abbreviation);

        const meaning = document.createElement('td');
        meaning.innerText = value;
        row.appendChild(meaning);

        abbreviationsList.appendChild(row);
      });
    });

    // update active pack
    packsList.querySelectorAll('a').forEach(a => {
      a.classList.remove('active');
      if (a.innerText === packName) {
        a.classList.add('active');
      }
    });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>